## Работа со stimulus реализацией Ajax
**Данный функционал все ещё находится в разработке, так что данная информация будет обновляться и изменяться.**
<br><br>
***На данный момент я делаю этот пакет для личного использования, так что некоторые особенности его работы могут отсутствовать в документации. Я также не гарантирую его поддержку.***
<br><br>
Данная часть предполагает, что читающий это разработчик уже знаком с основами [Stimulus.js](https://stimulus.hotwire.dev/)
<br><br>
Для использования нужно подключить у себя `AjaxLoaderController` и зарегистрировать его у Stimulus
```js
import { AjaxLoaderController } from "stimulus-ajax-filtering"
Stimulus.register("ajax-loader", AjaxLoaderController)
```
<br><br>
Есть 2 основных контроллера: **ajax-loader** и **ajax-filter**.<br>
+ **ajax-loader** подгружает данные и отображает их на странице<br>
+ **ajax-filter** фильтрует данные для передачи их в ajax-loader<br>

#### Атрибуты ajax-loader
+ `data-ajax-loader-name-value=""` - имя данного лоадера. Позволяет связывать лоадер с конкретными фильтрами.<br>
Особенно полезен, если на странице более одного лоадера и каждый использует свой набор фильров.<br>
**Имя лоадера не должно содержать пробелов**
+ `data-ajax-loader-url-value=""` - адрес, куда будет отправлен ajax-запрос
+ `data-ajax-loader-target="loader"` - указывает элемент, поверх которого будет отображаться лоадер во время выполнения запроса

#### Атрибуты ajax-filter
Все атрибуты должны быть связаны с конкретной реализацией контроллера (см. *Создание собственной реализации фильтра* ниже) (т.е. `ajax-filter` нужно заменить на название реализующего контроллера (например ajax-filter-input))
+ `data-ajax-filter-name=""` - имя ключа для значения данного фильтра при отправке ajax-запроса
+ `data-loader-name=""` - имя лоадера, связанного с данным фильтром

#### Связывание фильтра и лоадера
Для связывания фильтра с конкретным лоадером необходимо у элемента фильтра указать атрибут
```
data-ajax-name="loader-name"
``` 
Если нужно связать с данными фильтром более одного лоадера, названия лоадеров следует указать через пробел
```
data-ajax-name="loader1 loader2 loader3"
```
#### Срабатывание лоадера при изменении значения фильтра
Для того, чтобы отправить ajax запрос при изменении фильтра, у фильтра есть специальный метод `reloadAjax()`. Данный метод посылает запрос на перезагрузку в лоадер. При этом выполянть запрос или нет - решает сам лоадер
```html
<!-- Отправка ajax-запроса при изменении занчения инпута -->
<input
    data-controller="ajax-filter-input"
    data-action="input->ajax-filter-input#reloadAjax" <--- эта строка отвечает за вызов метода при изменении значения
>
```
#### Создание собственной реализации фильтра
При отправке ajax-запроса лоадер проходит по всем связанным фильтрам и запрашивает их имя (ключ) и значение. 
Он запрашивает эти значения у контроллера соответствующего элемента. 
Так как разные элементы требуют различного кода извлечения значения, было принято решение о написании общего фильтра, от которого будут наследоваться конкретные реализации.
<br>
При создании собственной реализации фильтра необходимо наследоваться от класса `AjaxFilterController`.<br>
При этом необходимо реализовать метод `get value()`, который должен возвращать значение фильтра.
```js
//Пример реализации фильтра, работающего с input, select и подобными элементами

import { AjaxFilterController } from "./ajax-filter-controller"

export default class extends AjaxFilterController {
    
    /**
     * Данный метод должен быть реализован в зависимости от типа фильтра
     */
    get value() {
        return this.element.value;
    }
}
```
Соответственно, в html-коде при этом все атрибуты должны быть связаны с этим контроллером
```html
<input
    data-controller="ajax-filter-input"
    data-action="input->ajax-filter-input#reloadAjax"
    data-ajax-filter-input-name-value="date"
>
```
Также, из этого вытекает важное и вполне очевидное ограничение: <br>
**Одному элементу может одновременно быть назначен только один ajax-filter**<br>
Это также связано с особенностями реализации, так что лучше не забывать об этом.

#### Отображение результата
В лоадере предусмотрена возможность выбора элементов, куда будет отображен результат. Для задания элемента отображения необходимо задать таргет с названием dest у нужного элемента 
```html
<div data-ajax-loader-target="dest">Результат будет помещен сюда</div>
```
Помимо этого также необходимо задать тип значения, которое будет помещено в элемент. Это делается при помощи data-атрибута `data-dest-type`<br>
Значение данного атрибута должно совпадать со значением ключа результирующей коллекции<br>
Например, если в качестве ответа от сервера приходит объект следующего вида:
```js
{
  some_key: 'Content',
  some_other_key: 'Other content'
}
```
то для отображения этих двух полей можно воспользоваться следующей конструкцией:
```html
<div 
    data-ajax-loader-target="dest"
    data-dest-type="some_key"
>
Сюда будет выведено "Content"
</div>

<div 
    data-ajax-loader-target="dest"
    data-dest-type="some_other_key"
>
Сюда будет выведено "Other content"
</div>
```

Не задокументированные атрибуты (руки пока не дошли):
<br>
+ `data-[ajax-filter-input]-debounce-value` - продолжительность debounce при обновлении значения инпута
+ `data-ajax-loader-run-on-page-load-value` - нужно ли отправлять запрос при открытии страницы
+ dispatch события "resultsShown" у ajax loader после отображения результатов
